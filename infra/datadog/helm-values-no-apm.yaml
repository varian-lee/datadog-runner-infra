# ğŸ“Š Datadog Agent Helm Values - Kubernetes í´ëŸ¬ìŠ¤í„° í†µí•© ëª¨ë‹ˆí„°ë§
# 
# ì£¼ìš” ê¸°ëŠ¥:
# - APM: ë¶„ì‚° íŠ¸ë ˆì´ì‹± (ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤)
# - ë¡œê·¸: ì»¨í…Œì´ë„ˆ ë¡œê·¸ ìˆ˜ì§‘ ë° íŒŒì‹±
# - ë©”íŠ¸ë¦­: ì‹œìŠ¤í…œ, ì• í”Œë¦¬ì¼€ì´ì…˜, ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­
# - Autodiscovery: ìë™ ì„œë¹„ìŠ¤ ë°œê²¬ ë° ì„¤ì •
# - OpenMetrics: Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (KrakenD)
# 
# ì„¤ì • íˆìŠ¤í† ë¦¬:
# - ì²˜ìŒ datadog.env: demo ë¡œ ì„¤ì •í–ˆë‹¤ê°€ Helm template ì˜¤ë¥˜ ë°œìƒí•˜ì—¬ tags ë°©ì‹ìœ¼ë¡œ ë³€ê²½
datadog:
  site: datadoghq.com
  clusterName: datadog-runner-cluster 
  # ìƒˆë¡œìš´ Datadog ê³„ì •ìœ¼ë¡œ ë³€ê²½ ì‹œ:
  # ë°©ë²• 1: ì§ì ‘ API key ì„¤ì •
  # apiKey: "ìƒˆë¡œìš´_API_í‚¤"
  # ë°©ë²• 2: ìƒˆë¡œìš´ secret ì°¸ì¡°  
  # apiKeyExistingSecret: datadog-secret
  apiKeyExistingSecret: datadog-secret-new
  # logLevel: debug               # DEBUG ë¡œê·¸ í™œì„±í™” ì‹œ ì£¼ì„ í•´ì œ (í™˜ê²½ë³€ìˆ˜ DD_LOG_LEVELê³¼ í•¨ê»˜ ì‚¬ìš©)
  tags:
    - env:demo                    # í™˜ê²½ íƒœê·¸ (ì„œë¹„ìŠ¤ë“¤ê³¼ ì¼ì¹˜)
    - testtag:testtag_value                    # í…ŒìŠ¤íŠ¸ íƒœê·¸
    - cluster_name:datadog-runner-cluster  # í´ëŸ¬ìŠ¤í„° íƒœê·¸ ì¶”ê°€
  logs:
    enabled: true
    containerCollectAll: true     # ëª¨ë“  ì»¨í…Œì´ë„ˆ ë¡œê·¸ ìˆ˜ì§‘
  apm:
    enabled: false                 # Application Performance Monitoring
    portEnabled: false       # TCP í¬íŠ¸ 8126 ë¹„í™œì„±í™”
    socketEnabled: false     # Unix socket ë¹„í™œì„±í™”
  processAgent:
    enabled: false                 # í”„ë¡œì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§
  networkMonitoring:
    enabled: false                 # ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§
  dbm:
    enabled: false                 # Database Monitoring
  kubeStateMetricsEnabled: false   # K8s ìƒíƒœ ë©”íŠ¸ë¦­
  
  # Kubelet Integration ì»¤ìŠ¤í„°ë§ˆì´ì œì´ì…˜
  # kubernetes.kubelet.pod.start.duration.count ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ìœ„í•´ Python check ì‚¬ìš©
  kubelet:
    coreCheckEnabled: false       # Go ì½”ì–´ ì²´í¬ ë¹„í™œì„±í™”, Python ì²´í¬ í™œì„±í™”
  
  # confd ì‚¬ìš© ì‹œ ê¸°ì¡´ ì„¤ì •ì„ ì™„ì „íˆ ëŒ€ì²´í•˜ë¯€ë¡œ í•„ìˆ˜ ì„¤ì •ë“¤ì„ ëª¨ë‘ í¬í•¨
  confd:
    kubelet.yaml: |-
      ad_identifiers:             # Autodiscovery ì‹ë³„ì (í•„ìˆ˜)
        - _kubelet
      init_config: null           # ì´ˆê¸°í™” ì„¤ì • (í•„ìˆ˜)
      instances:
        - min_collection_interval: 20           # 20ì´ˆ ê°„ê²©ìœ¼ë¡œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
          send_distribution_buckets: true       # íˆìŠ¤í† ê·¸ë¨ ë²„í‚·ì„ ë¶„í¬ë¡œ ì „ì†¡
          # ì°¸ê³ : send_distribution_buckets í™œì„±í™” ì‹œ ì¼ë¶€ duration ë©”íŠ¸ë¦­ì´ ì‚¬ë¼ì§€ëŠ” ì´ìŠˆ ì¡´ì¬

# Agent ì»¨í…Œì´ë„ˆ ì„¤ì •
agents:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: is-dd-apm
            operator: DoesNotExist    # is-dd-apm ë¼ë²¨ì´ ì—†ëŠ” ë…¸ë“œ (APM ë¹„í™œì„±í™”)

  containers:
    agent:
      env:
        # APM ì™„ì „ ë¹„í™œì„±í™”
        - name: DD_APM_ENABLED
          value: "false"
        # ë¡œì»¬ì´ ì•„ë‹Œ íŠ¸ë˜í”½ìœ¼ë¡œë¶€í„°ì˜ APM íŠ¸ë ˆì´ìŠ¤ ìˆ˜ì‹  ì°¨ë‹¨
        - name: DD_APM_NON_LOCAL_TRAFFIC
          value: "false"
        # ë¡œì»¬ì´ ì•„ë‹Œ ì†ŒìŠ¤ë¡œë¶€í„°ì˜ DogStatsD ë©”íŠ¸ë¦­ ìˆ˜ì‹  í—ˆìš©  
        - name: DD_DOGSTATSD_NON_LOCAL_TRAFFIC
          value: "false"
        
        # ğŸ”„ Dual Shipping ì„¤ì • - APM ì œì™¸í•˜ê³  ë©”íŠ¸ë¦­ + ë¡œê·¸ë§Œ
        # ğŸ“Š ë©”íŠ¸ë¦­ Dual Shipping
        - name: DD_ADDITIONAL_ENDPOINTS
          valueFrom:
            secretKeyRef:
              name: datadog-dual-shipping-secret
              key: metrics
        
        # ğŸ“‹ ë¡œê·¸ Dual Shipping  
        - name: DD_LOGS_CONFIG_FORCE_USE_HTTP
          value: "true"
        - name: DD_LOGS_CONFIG_ADDITIONAL_ENDPOINTS
          valueFrom:
            secretKeyRef:
              name: datadog-dual-shipping-secret
              key: logs

# ê¸°ì¡´ Cluster Agent ì¬ì‚¬ìš©
existingClusterAgent:
  join: true
  serviceName: "datadog-standard-cluster-agent"        # Standard ë°°í¬ì˜ Cluster Agent ì„œë¹„ìŠ¤
  tokenSecretName: "datadog-standard-cluster-agent"    # Standard ë°°í¬ì˜ ì¸ì¦ í† í°

# Cluster Agent ì¤‘ë³µ ë°©ì§€
clusterAgent:
  enabled: false