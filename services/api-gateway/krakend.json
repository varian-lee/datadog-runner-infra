{
  "_comment": "üö™ KrakenD API Gateway ÏÑ§Ï†ï - Datadog Runner ÌîÑÎ°úÏ†ùÌä∏",
  "_description": "ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ ÌÜµÌï© API Gateway - Î™®Îì† Î∞±ÏóîÎìú ÏÑúÎπÑÏä§ ÎùºÏö∞ÌåÖ, OpenTelemetry Î©îÌä∏Î¶≠, Î∂ÑÏÇ∞ Ìä∏Î†àÏù¥Ïã± ÏßÄÏõê",
  "_features": [
    "‚úÖ ÌÜµÌï© API ÏóîÎìúÌè¨Ïù∏Ìä∏ (/api/auth, /api/chat, /api/ranking, /rankings)",
    "‚úÖ OpenTelemetry Prometheus Î©îÌä∏Î¶≠ (Ìè¨Ìä∏ 9090)",
    "‚úÖ Î∂ÑÏÇ∞ Ìä∏Î†àÏù¥Ïã± Ìó§Îçî Ï†ÑÎã¨ (Datadog + W3C Trace Context)",
    "‚úÖ CORS ÏÑ§Ï†ï Î∞è Ïø†ÌÇ§ Í∏∞Î∞ò Ïù∏Ï¶ù ÏßÄÏõê",
    "‚úÖ no-op Ïù∏ÏΩîÎî©ÏúºÎ°ú ÏõêÌòï ÏùëÎãµ Ï†ÑÎã¨"
  ],
  "$schema": "https://www.krakend.io/schema/krakend.json",
  "version": 3,
  "name": "Datadog Runner API Gateway",
  "port": 8080,
  "cache_ttl": "3600s",
  "timeout": "30s",
  "extra_config": {
    "telemetry/opentelemetry": {
      "service_name": "api-gateway",
      "service_version": "0.1.0",
      "exporters": {
        "prometheus": [
          {
            "name": "krakend_metrics",
            "port": 9090,
            "listen_ip": "0.0.0.0",
            "process_metrics": true,
            "go_metrics": true
          }
        ]
      },
      "layers": {
        "global": {
          "disable_metrics": false,
          "disable_traces": false
        },
        "router": {
          "disable_metrics": false,
          "disable_traces": false,
          "metrics": {
            "detailed_connection": true,
            "round_trip": true,
            "read_payload": true,
            "static_attributes": [
              {
                "key": "layer",
                "value": "router"
              },
              {
                "key": "service_type", 
                "value": "api_gateway"
              }
            ]
          }
        },
        "proxy": {
          "disable_metrics": false,
          "disable_traces": false,
          "metrics": {
            "detailed_connection": true,
            "round_trip": true,
            "read_payload": true,
            "disable_stage": false,
            "static_attributes": [
              {
                "key": "layer",
                "value": "proxy"
              },
              {
                "key": "service_type",
                "value": "api_gateway"
              }
            ]
          }
        },
        "backend": {
          "disable_metrics": false,
          "disable_traces": false,
          "metrics": {
            "disable_stage": false,
            "round_trip": true,
            "read_payload": true,
            "detailed_connection": true,
            "static_attributes": [
              {
                "key": "layer",
                "value": "backend"
              },
              {
                "key": "backend_type",
                "value": "api_gateway"
              }
            ]
          }
        },
        "pipe": {
          "disable_metrics": false,
          "disable_traces": false,
          "metrics": {
            "detailed_connection": true,
            "round_trip": true,
            "static_attributes": [
              {
                "key": "layer",
                "value": "pipe"
              }
            ]
          }
        }
      }
    },
    "security/cors": {
      "allow_origins": ["*"],
      "allow_methods": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"],
      "allow_headers": [
        "*",
        "Content-Type", 
        "Authorization",
        "X-Requested-With",
        "x-datadog-trace-id",
        "x-datadog-parent-id", 
        "x-datadog-origin",
        "x-datadog-sampling-priority",
        "traceparent",
        "tracestate",
        "b3"
      ],
      "expose_headers": [
        "Content-Length", 
        "Content-Type",
        "x-datadog-trace-id",
        "x-datadog-parent-id",
        "traceparent",
        "tracestate"
      ],
      "allow_credentials": true,
      "max_age": "12h"
    }
  },
  "endpoints": [
    {
      "endpoint": "/health",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false
        }
      ],
      "extra_config": {
        "proxy": {
          "static": {
            "data": {
              "status": "ok",
              "service": "api-gateway",
              "timestamp": "2025-09-10T15:30:00Z"
            },
            "strategy": "always"
          }
        }
      }
    },
    {
      "endpoint": "/api/auth/{path}",
      "method": "GET",
      "output_encoding": "no-op",
      "input_headers": [
        "Cookie", "Authorization",
        "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
        "traceparent", "tracestate", "b3"
      ],
      "output_headers": [
        "Set-Cookie",
        "x-datadog-trace-id", "x-datadog-parent-id",
        "traceparent", "tracestate"
      ],
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": {
          "request_headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ],
          "response_headers_to_pass": [
            "Set-Cookie",
            "x-datadog-trace-id", "x-datadog-parent-id",
            "traceparent", "tracestate"
          ]
        }
      },
      "backend": [
        {
          "url_pattern": "/auth/{path}",
          "encoding": "no-op",
          "sd": "static",
          "method": "GET",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ]
        }
      ]
    },
    {
      "endpoint": "/api/auth/{path}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "Cookie", "Authorization",
        "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
        "traceparent", "tracestate", "b3"
      ],
      "output_headers": [
        "Set-Cookie",
        "x-datadog-trace-id", "x-datadog-parent-id",
        "traceparent", "tracestate"
      ],
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": {
          "request_headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ],
          "response_headers_to_pass": [
            "Set-Cookie",
            "x-datadog-trace-id", "x-datadog-parent-id",
            "traceparent", "tracestate"
          ]
        }
      },
      "backend": [
        {
          "url_pattern": "/auth/{path}",
          "encoding": "no-op",
          "sd": "static",
          "method": "POST",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ]
        }
      ]
    },
    {
      "endpoint": "/api/auth/{path}",
      "method": "DELETE",
      "output_encoding": "no-op",
      "input_headers": [
        "Cookie", "Authorization",
        "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
        "traceparent", "tracestate", "b3"
      ],
      "output_headers": [
        "Set-Cookie",
        "x-datadog-trace-id", "x-datadog-parent-id",
        "traceparent", "tracestate"
      ],
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": {
          "request_headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ],
          "response_headers_to_pass": [
            "Set-Cookie",
            "x-datadog-trace-id", "x-datadog-parent-id",
            "traceparent", "tracestate"
          ]
        }
      },
      "backend": [
        {
          "url_pattern": "/auth/{path}",
          "encoding": "no-op",
          "sd": "static",
          "method": "DELETE",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ]
        }
      ]
    },
    {
      "endpoint": "/api/session/{path}",
      "method": "GET",
      "output_encoding": "no-op",
      "input_headers": [
        "Cookie", "Authorization",
        "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
        "traceparent", "tracestate", "b3"
      ],
      "output_headers": [
        "Set-Cookie",
        "x-datadog-trace-id", "x-datadog-parent-id",
        "traceparent", "tracestate"
      ],
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": {
          "request_headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ],
          "response_headers_to_pass": [
            "Set-Cookie",
            "x-datadog-trace-id", "x-datadog-parent-id",
            "traceparent", "tracestate"
          ]
        }
      },
      "backend": [
        {
          "url_pattern": "/session/{path}",
          "encoding": "no-op",
          "sd": "static",
          "method": "GET",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ]
        }
      ]
    },
    {
      "endpoint": "/api/score",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "Cookie", "Authorization",
        "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
        "traceparent", "tracestate", "b3"
      ],
      "output_headers": [
        "Set-Cookie",
        "x-datadog-trace-id", "x-datadog-parent-id",
        "traceparent", "tracestate"
      ],
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": {
          "request_headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ],
          "response_headers_to_pass": [
            "Set-Cookie",
            "x-datadog-trace-id", "x-datadog-parent-id",
            "traceparent", "tracestate"
          ]
        }
      },
      "backend": [
        {
          "url_pattern": "/score",
          "encoding": "no-op",
          "sd": "static",
          "method": "POST",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "headers_to_pass": [
            "Cookie", "Authorization",
            "x-datadog-trace-id", "x-datadog-parent-id", "x-datadog-origin", "x-datadog-sampling-priority",
            "traceparent", "tracestate", "b3"
          ]
        }
      ]
    },
    {
      "endpoint": "/api/chat",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["chat-node-svc:8080"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/api/chat/{path}",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/{path}",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["chat-node-svc:8080"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/api/chat/{path}",
      "method": "POST",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/{path}",
          "encoding": "json",
          "sd": "static",
          "method": "POST",
          "host": ["chat-node-svc:8080"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/api/ranking",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["ranking-java-svc:8081"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/api/ranking/{path}",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/{path}",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["ranking-java-svc:8081"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/api/ranking/{path}",
      "method": "POST",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/{path}",
          "encoding": "json",
          "sd": "static",
          "method": "POST",
          "host": ["ranking-java-svc:8081"],
          "disable_host_sanitize": false
        }
      ]
    },
    {
      "endpoint": "/rankings/{path}",
      "method": "GET",
      "output_encoding": "no-op",
      "input_query_strings": ["limit"],
      "backend": [
        {
          "url_pattern": "/rankings/{path}",
          "encoding": "no-op",
          "sd": "static",
          "method": "GET",
          "host": ["ranking-java-svc:8081"],
          "disable_host_sanitize": false
        }
      ],
      "extra_config": {
        "qos/http-cache": {
          "disabled": true
        },
        "backend/http": {
          "max_idle_connections": 2,
          "max_idle_connections_per_host": 1,
          "_comment_connections": "Connection Pool Ï†úÌïú - ranking-java HikariCP(1Í∞ú) Í≥†Í∞àÎ°ú ÏàúÏàòÌïú ÎåÄÍ∏∞ ÌÅê Ìö®Í≥º ÌÖåÏä§Ìä∏",
          "disable_compression": false,
          "disable_keep_alives": false
        }
      }
    },
    {
      "endpoint": "/api/status",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["auth-python-svc:8000"],
          "disable_host_sanitize": false,
          "group": "auth"
        },
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["chat-node-svc:8080"],
          "disable_host_sanitize": false,
          "group": "chat"
        },
        {
          "url_pattern": "/",
          "encoding": "json",
          "sd": "static",
          "method": "GET",
          "host": ["ranking-java-svc:8081"],
          "disable_host_sanitize": false,
          "group": "ranking"
        }
      ]
    }
  ]
}